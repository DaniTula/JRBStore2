{% extends "base.html" %}

{% block title %}JRBStore2 - Cat√°logo{% endblock %}

{% block content %}

<!--
  Barra de navegaci√≥n principal:
  - Men√∫ lateral (offcanvas)
  - Logo / nombre de la tienda
  - Buscador central
  - Icono carrito
  - Enlaces "Iniciar sesi√≥n / Registrarse"
-->
<nav class="navbar navbar-dark bg-primary py-1">
  <div class="container-fluid px-2">

    <!-- Bot√≥n que abre el panel administrativo (offcanvas) -->
    <button class="btn btn-outline-light me-2"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#adminPanel"
            aria-controls="adminPanel">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Nombre de la tienda -->
    <a class="navbar-brand fw-bold fs-5 me-2" href="{% url 'home' %}">
      JRBStore
    </a>

    <!-- Buscador central (solo md en adelante) -->
    <form class="d-none d-md-flex flex-grow-1 justify-content-center mx-2">
      <input class="form-control w-50"
             type="search"
             placeholder="¬øQu√© desea encontrar?"
             aria-label="Buscar" />
    </form>

    <!-- Icono de carrito -->
    <a href="{% url 'cart_detail' %}" class="btn btn-outline-light ms-2">
      üõí
      {% if cart_total_items %}
        <span class="badge bg-light text-primary ms-1">{{ cart_total_items }}</span>
      {% endif %}
    </a>

    <!-- Enlaces de autenticaci√≥n -->
    <div class="d-flex align-items-center text-white ms-2">
      <a href="#" class="text-white text-decoration-none me-1">
        Iniciar sesi√≥n
      </a>
      <span class="mx-1">/</span>
      <a href="#" class="text-white text-decoration-none ms-1">
        Registrarse
      </a>
    </div>
  </div>
</nav>

{# MENSAJES FLASH BAJO LA BARRA #}
{% if messages %}
  <div class="container-fluid mt-2">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show mb-2" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<!--
  Layout principal:
  - Columna izquierda: filtros (sidebar)
  - Columna derecha: cat√°logo de productos
-->
<div class="container-fluid py-3">
  <div class="row">

    <!-- Sidebar de filtros -->
    <aside class="col-12 col-md-4 col-lg-3 mb-3">
      <div class="p-3 bg-primary text-white rounded">

        <!-- Filtro: Consola (solo PlayStation) -->
        <div class="mb-4">
          <div class="fw-semibold mb-1">Consola</div>
          <select class="form-select form-select-sm">
            <option selected>Todas</option>
            <option>PS3</option>
            <option>PS4</option>
            <option>PS5</option>
          </select>
        </div>

        <!-- Filtro: Tipo -->
        <div class="mb-4">
          <div class="fw-semibold mb-2">Tipo</div>

          <div class="form-check">
            <input class="form-check-input"
                   type="radio"
                   name="tipo"
                   id="tipoTodos"
                   checked />
            <label class="form-check-label" for="tipoTodos">
              Todos
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="radio"
                   name="tipo"
                   id="tipoFisico" />
            <label class="form-check-label" for="tipoFisico">
              F√≠sico
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="radio"
                   name="tipo"
                   id="tipoDigital" />
            <label class="form-check-label" for="tipoDigital">
              Digital/llave
            </label>
          </div>
        </div>

        <!-- Filtro: G√©neros -->
        <div class="mb-4">
          <div class="fw-semibold mb-1">G√©neros</div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="accion"
                   id="genAccion">
            <label class="form-check-label" for="genAccion">
              Acci√≥n
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="aventura"
                   id="genAventura">
            <label class="form-check-label" for="genAventura">
              Aventura
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="battle-royale"
                   id="genBattleRoyale">
            <label class="form-check-label" for="genBattleRoyale">
              Battle Royale
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="carreras"
                   id="genCarreras">
            <label class="form-check-label" for="genCarreras">
              Carreras
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="deportes"
                   id="genDeportes">
            <label class="form-check-label" for="genDeportes">
              Deportes
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="estrategia"
                   id="genEstrategia">
            <label class="form-check-label" for="genEstrategia">
              Estrategia
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="hack-and-slash"
                   id="genHackSlash">
            <label class="form-check-label" for="genHackSlash">
              Hack and Slash
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="rpg"
                   id="genRpg">
            <label class="form-check-label" for="genRpg">
              RPG
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="shooter"
                   id="genShooter">
            <label class="form-check-label" for="genShooter">
              Shooter
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   value="terror"
                   id="genTerror">
            <label class="form-check-label" for="genTerror">
              Terror
            </label>
          </div>

          <small class="d-block mt-1">
            Puedes seleccionar varios.
          </small>
        </div>

        <!-- Filtro: Precio -->
        <div class="mb-3">
          <div class="fw-semibold mb-1">Precio</div>
          <div class="row g-2 mb-2">
            <div class="col-6">
              <input type="number"
                     class="form-control form-control-sm"
                     placeholder="min" />
            </div>
            <div class="col-6">
              <input type="number"
                     class="form-control form-control-sm"
                     placeholder="max" />
            </div>
          </div>

          <div class="d-grid mb-2">
            <button class="btn btn-success btn-sm" type="button">
              üîç Aplicar filtros
            </button>
          </div>

          <div class="d-grid">
            <button class="btn btn-outline-light btn-sm" type="button">
              ‚úñ Limpiar
            </button>
          </div>
        </div>

      </div>
    </aside>

    <!-- √Årea principal de productos -->
    <main class="col-12 col-md-8 col-lg-9 mb-3">
      {% if productos %}
        <div class="row g-3">
          {% for producto in productos %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
              <div class="card h-100 shadow-sm"
                   onmouseover="this.classList.add('shadow')"
                   onmouseout="this.classList.remove('shadow')">

                {% if producto.imagen %}
                  <img src="{{ producto.imagen.url }}"
                       class="card-img-top"
                       alt="{{ producto.nombre }}"
                       style="height: 200px; object-fit: cover;">
                {% endif %}

                <div class="card-body d-flex flex-column">

                  <h5 class="card-title mb-1">
                    {{ producto.nombre }}
                  </h5>

                  <p class="mb-1 small text-muted">
                    {{ producto.anio_lanzamiento|date:"Y" }}
                    ¬∑ {{ producto.plataforma }}
                    ¬∑ {{ producto.get_formato_display }}
                    ¬∑ {{ producto.get_estado_display }}
                  </p>

                  <p class="mb-1 small text-muted">
                    {{ producto.generos.all|join:", " }}
                  </p>

                  <p class="card-text small mb-2">
                    {{ producto.descripcion|default:"Sin descripci√≥n."|truncatechars:110 }}
                  </p>

                  <div class="mt-auto d-flex justify-content-between align-items-center">
                    <span class="fw-bold fs-5">
                      ${{ producto.valor }}
                    </span>
                    <a href="{% url 'cart_add' producto.id %}"
                       class="btn btn-sm btn-primary">
                      Agregar al carrito
                    </a>
                  </div>

                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
            <div class="mb-3" style="font-size: 3rem;">
              üì¶
            </div>
            <h5 class="card-title mb-2">
              A√∫n no hay productos
            </h5>
            <p class="card-text text-muted">
              Cuando agregues items, aparecer√°n aqu√≠.
            </p>
          </div>
        </div>
      {% endif %}
    </main>

  </div>
</div>

<!-- Offcanvas (panel administrativo) -->
<div class="offcanvas offcanvas-start"
     tabindex="-1"
     id="adminPanel"
     aria-labelledby="adminPanelLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="adminPanelLabel">
      Panel administrativo
    </h5>
    <button type="button"
            class="btn-close text-reset"
            data-bs-dismiss="offcanvas"
            aria-label="Cerrar"></button>
  </div>

  <div class="offcanvas-body">
    <div class="list-group">
      <a href="/admin/" class="list-group-item list-group-item-action">
        Admin Django
      </a>
      <a href="{% url 'product_list' %}" class="list-group-item list-group-item-action">
        Productos
      </a>
    </div>
  </div>
</div>

{% endblock %}


